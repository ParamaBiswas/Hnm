
@{
    ViewData["Title"] = "Terms And Condition";
}
<head>
    <script type="text/javascript">
        var objTermsAndCondition =[];
        var pArray = new Array();
        var server = "https://192.168.20.83";
        var requestUrl;
        

        var pUserCode = "";
        var pCompanyCode = 1;

        window.onload = function () {
            CheckUserIsLogedIn();
           
        }

        function CheckUserIsLogedIn() {
            debugger
            GetCookie();

            if (pUserCode != "NotLogedIn") {
                LoadData();
            }
            else {
                requestUrl = server + "/centerpoint/Product/ProductUI";
                Cookies.set('RequestURL', requestUrl, { expires: 1 });
                window.location.href = "../Login/LoginPageUI";
            }
        }
        function GetCookie() {
            debugger
            pUserCode = Cookies.get('UserID');

            if (pUserCode == null || pUserCode == "") {
                // do cookie doesn't exist stuff;
                pUserCode = "NotLogedIn";
            }
            else {
                // do cookie exists stuff
                pUserCode = Cookies.get('UserID');
            }
        }

        function Add() {
            var index = $("#tblterms").children("tr").length;
            var pCondition = $("#Condition").val();
            var pConditionValue = $("#ConditionValue").val();
            var pValueType = $("#ValueType").val();
            AddTermsList(index, pCondition, pConditionValue, pValueType, pValueTypeName,null);
        }
        function AddTermsList(index, pCondition, pConditionValue, pValueType, pValueTypeName) {
            //var CompanyCode_FK = 1;
            var ActionType = 'INSERT';
            //var UserCode = '9C6CA730-34AB-40B2-A0DC-17CD77330B9E';
            var obj = {
               
                    "ConditionValue": 0,
                    "ConditionCode_PK": "",
                    "Condition": "",
                    "ValueType": 0,
                    "CompanyCode_FK": 0,
                    "ActionType": "",
                    "UserCode": ""
            };
            var indexCell = "<td style='display:none'><input name='Terms.Index' type='hidden' value='" +
                index +
                "' /></td>";
            var ConditionCodeCell = "<td style='display:none'><input id='Terms_" +
                index +
                "_Condition' name='Terms[" +
                index +
                "].ConditionCodeCell' value='" +
                index +
                "' />" +
                index +
                "</td>";
            var ConditionCodePkCell = "<td style='display:none'><input id='Terms_" +
                index +
                "_Condition' name='Terms[" +
                index +
                "].ConditionCode' value='" +
                index +
                "' />" +
                index +
                "</td>";

            var ConditionCell = "<td><input type='hidden' id='Terms_" +
                index +
                "_Condition' name='Terms[" +
                index +
                "].Condition' value='" +
                pCondition +
                "' />" +
                pCondition +
                "</td>";
            var ConditionValueCell = "<td><input type='hidden' id='Terms_" +
                index +
                "_ConditionValue' name='Terms[" +
                index +
                "].ConditionValue' value='" +
                pConditionValue +
                "' />" +
                pConditionValue +
                "</td>";

            var ValueTypeCell = "<td><input type='hidden' id='Terms_" +
                index +
                "_ValueType' name='Terms[" +
                index +
                "].ValueType' value='" +
                pValueTypeName +
                "' />" +
                pValueTypeName +
                "</td>";


            var removeCell =
                "<td><input id='btnRemoveTerm' class='btn btn-icon btn-danger btn-rounded' type='button' value='Remove' onclick='RemoveTermRow(" +
                index +
                ",\"" +
                pCondition +
                "\");' /></td>";
            var newRow = "<tr id='tblterms" +
                index +
                "'>" +
                indexCell +
                ConditionCodeCell+
                ConditionCell +
                ConditionValueCell +
                ValueTypeCell +
                removeCell +
                "</tr>";

            $("#tblterms").append(newRow);
            pArray.push({ Condition: pCondition });
            pArray.push({ index: index })
            
            obj.ConditionValue = pConditionValue;
            obj.ConditionCode_PK = "";
            obj.ValueType = pValueType;
            obj.Condition = pCondition;
            obj.CompanyCode_FK = pCompanyCode;
            obj.ActionType = ActionType;
            obj.UserCode = pUserCode;
            //var datas = JSON.stringify(objTermsAndCondition);
            //debugger
            objTermsAndCondition.push(obj);
            //alert(datas);
        }
        function RemoveTermRow(id, type) {
            var controlToBeRemoved = "#tblterms" + id;
            $(controlToBeRemoved).remove();
            var index = findWithAttr(type);
            pArray.splice(index, 1);

        }
        function SubmitBtnClick() {
            var newObj = {
                "objTermsAndCondition": [{
                    "ConditionValue": 0,
                    "ConditionCode_PK": "",
                    "Condition": "",
                    "ValueType": 0,
                    "CompanyCode_FK": 0,
                    "ActionType": "",
                    "UserCode": ""
                }]
            };
            newObj.objTermsAndCondition = objTermsAndCondition;
            var datas = JSON.stringify(newObj);
            alert(datas);
            $.ajax(
                {
                    url: server + "/Procurement/api/TermAndCondition/SaveTermsAndCondition",
                    dataType: "json",
                    processData: false,
                    contentType: 'application/json',
                    type: "POST",
                    data: datas,
                    crossDomain: "true",
                    success: function (data) {
                        document.location.reload();
                        alert("Save Succesfull!");
                    },
                    error: function () {
                        alert("There was error saving data!");
                    }
                }
            );


        }
        function NewBtnClick() {
            document.location.reload();
        }
        function LoadData() {
            $.ajax(
                {
                    url: server + "/Procurement/api/TermAndCondition/GetTermsAndCondition",
                    dataType: "json",
                    processData: false,
                    contentType: 'application/json',
                    type: "GET",
                    crossDomain: "true",
                    success: function (data) {
                        
                        alert("OK");
                        SetData(data);
                    },
                    error: function () {
                        alert("There was error loading data!");
                    }
                }
            );
        }
        function SetData(data) {
            $('.ListTable').find('tr').not('.HeaderRow').remove();
            var vNewRow;
            var vCheckBox;


            for (var i = 0; i < data.termsAndConditions.length; i++) {
                AddTermsList(i, data.termsAndConditions[i].Condition, data.termsAndConditions[i].ConditionValue, data.termsAndConditions[i].ValueType, data.termsAndConditions[i].ValueTypeName_VW);
                

            }
        }
        //function findWithAttr(pTcValue) {

        //    if (arrayPurchaseRequisitionTermsList_VW.length > 0) {
        //        for (var i = 0; i < arrayPurchaseRequisitionTermsList_VW.length; i += 1) {
        //            if (arrayPurchaseRequisitionTermsList_VW[i]["ConditionCode_PK"] === pTcValue) {
        //                editTermsDescription = arrayPurchaseRequisitionTermsList_VW[i].Remarks;
        //                return i;
        //            }

        //        }
        //    }

        //    return -1;
        //}

    </script>
    </head>
<h2>TermsAndCondition</h2>
<div class="container" style="margin-top:85px">
    <div class="row">
        <div class="col-md-4">
            <div class="form-group">
                <div class="col-md-4">
                    <label class="col-md-15 control-label">Condition</label>

                </div>
                <div class="col-md-5">
                    @Html.TextBox("Condition", null, new { @class = "form-control" })


                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <div class="col-md-5">
                    <label class="col-md-15 control-label">Condition Value</label>

                </div>
                <div class="col-md-5">
                    @Html.TextBox("ConditionValue", null, new { @class = "form-control" })


                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <div class="col-md-4">
                    <label class="col-md-15 control-label">Value Type</label>

                </div>
                <div class="col-md-5">
                    <select id="ValueType">
                        <option value="1">Fixed</option>
                        <option value="2">Percentage</option>
                    </select>
                    <button type="button" class="btn-add" onclick="Add()">Add</button>

                </div>
            </div>
        </div>
    </div>
    <table class="table table-striped ListTable">
        <thead>
            <tr class="HeaderRow">
                <th class="HeaderCell">Condition</th>
                <th class="HeaderCell">Condition Value</th>
                <th class="HeaderCell">Value Type</th>
                <th class="HeaderCell"></th>
            </tr>
        </thead>
        <tbody id="tblterms"></tbody>
    </table>
    <button type="button" id="addBtn" class="btn-add" onclick="SubmitBtnClick()" style="width:100px">Submit</button>
    <button type="button" id="addBtn" class="btn-add" onclick="NewBtnClick()" style="width:100px">New</button>
</div>


